# Codex Project Rules

This file defines mandatory project rules for Codex and automated code generation.
All generated or modified code MUST follow these rules unless explicitly instructed otherwise.

---

## Environment variables (.env)

- This project uses a `.env` file for configuration and secrets.
- Environment variables from `.env` are NOT available automatically.
- Any Python script that reads environment variables MUST explicitly load `.env`.

### Required pattern (Python)

```python
from dotenv import load_dotenv
load_dotenv()
```

- Access variables ONLY via `os.getenv(...)`
- NEVER hardcode secrets (tokens, keys)
- NEVER log secret values
- Missing required variables MUST raise an explicit error

### Example check

```python
value = os.getenv("SOME_VAR")
if not value:
    raise RuntimeError("SOME_VAR not set (check .env)")
```

---

## Google Apps Script Web App integration

- The project uses a Google Apps Script Web App as a backend service.
- Authentication is done via a shared token passed as a query parameter.
- Token value must be read from `.env`.

### Example request pattern

```
GET {GAS_WEBAPP_URL}?ep=endpointName&param=value&token=GAS_WEBAPP_TOKEN
```

- NEVER log the token
- Handle network and JSON errors explicitly

---

## YouTube API usage

- The project contains reusable YouTube API tools (OAuth, refresh token, helpers).
- These tools MUST NOT be removed unless explicitly instructed.
- Some scripts (e.g. `post_if_finished`) MUST NOT call YouTube API directly.
- Replacing YouTube API calls with internal services (GAS Web App) is allowed and preferred when specified.

---

## Code modification rules

- Modify ONLY files explicitly mentioned in the task.
- Do NOT refactor unrelated code.
- Do NOT introduce new dependencies unless required by the task.
- Preserve existing project structure.

---

## Error handling

- Prefer explicit errors over silent failures.
- Network errors must not crash the whole system without logging.
- Configuration errors must stop execution early.

---

## Style guidelines

- Keep functions small and focused.
- Avoid global state where possible.
- Use clear variable names.
- Do not add unnecessary abstractions.

---

## Forbidden actions

- Hardcoding secrets
- Removing authentication
- Logging tokens or credentials
- Changing APIs without instruction
- Assuming environment variables exist without loading `.env`

---

## Priority

If task instructions conflict with this file:
1. Explicit user instructions win
2. `.codex.md` rules apply
3. General best practices apply